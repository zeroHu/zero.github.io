---
title: auth-code
date: 2024-02-02 16:04:20
tags: authCode, auth
---

### 一点小思考

`在和做微信平台的开发的时候，有一个场景是这样的，微信方给出了一个code，5分钟过期，且用一次过期，调用方需要拿着code，与accessToken一起才能拿回用户相关信息。`

那我们可以从这个例子里面去分析哈，首先 accessToken 的获取需要我方的 appKey 与 appSecret 一起获取，那么可以保证这个是不被篡改的。
那么我们今天就是研究一下这里的 code 是如何生成的，是什么机制然后如何能保证 5 分钟过期，且调用一次过期。做到与 accessToken 一起使用，发送给微信，保障了信息获取流程的安全性。

```
# 从逻辑上思考，code应该是使用某种加密算法生成的一串随机字符串，而且加密之前的内容应该有以下内容

1. 时间戳（或者时间），反正解析出来后能够获取到生成时间的，因为有了生成时间才能判断有效时间
2. 用户信息的唯一标志，也就是通过这个唯一标志可以关联查询到用户相关信息


也就是说 code 是通过可以解码的算法来加密的
```

### 微信小程序交互方式分析

# 那么 accessToken

```
1. 这里的 accessToken 是通过appId + appSecret 获取到的


这里猜测：accessToken也是采用的可逆的加密算法获取的，但是为了防止时间过长被破译的可能性，所以设置了2h过期的，且有新的生成后旧的就自动过期的原理

那么这里的accessToken是服务器端的行为，理论上是完全不会被泄露的。

2. 当服务器端 拿着code + accessToken 就认为是能够安全的行为。
```

### 普通的 auth 认证流程

```
# 定制规则方：
接口1 - 生成: 可以采用可逆向解密的算法来生成一串code，返给用户方
接口2 - 生成：用户传入code 以及 Sign 以及 AppId 三个参数，通过协商好的Sign以及code来判断内容是否被篡改，若正常，则查出Code中根据用户唯一Id查出用户信息返回。

# 服务方：
接口3：通过AppId 和 AppSecret 以及 用户方给的 code 生成签名 Sign， 调用定制规则方的接口2来获取数据后返回给用户方


# 客户端用户方：
调用 - 接口1，拿到code，调用服务方接口3 获取到用户存于定制规则方的用户相关数据。


# 好文地址：
https://www.cnblogs.com/blowing00/p/4524412.html
```
