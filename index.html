<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>zeroBlog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="zeroBlog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="zeroBlog">
<meta property="og:locale">
<meta property="article:author" content="zero">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="zeroBlog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">zeroBlog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">zero&#39;s life and study record</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-stream" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/03/stream/" class="article-date">
  <time class="dt-published" datetime="2023-03-03T03:42:10.000Z" itemprop="datePublished">2023-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/03/stream/">stream</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="文件流"><a href="#文件流" class="headerlink" title="文件流"></a>文件流</h3><ol>
<li>可以对大文件进行操作</li>
</ol>
<p>Stream 有四种流类型:<br>. Readable - 可读性<br>. Writable - 可写性<br>. Duplex - 可读可写性<br>. Transform - 操作被写入数据，然后读出结果</p>
<p>所有的 Stream 对象都是 EventEmitter 的实例。常用的事件有：<br>. data - 当有数据可读时触发<br>. end - 没有更多的数据可读时触发<br>. error - 在接收和写入过程中发生错误时触发<br>. finish - 所有数据已被写入到底层系统时触发</p>
<h4 id="引入方式"><a href="#引入方式" class="headerlink" title="引入方式"></a>引入方式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; createReadStream, createWriteStream &#125; = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="从流中读取数据"><a href="#从流中读取数据" class="headerlink" title="从流中读取数据"></a>从流中读取数据</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> readStream = <span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>)</span><br><span class="line">readStream.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment">// 处理流事件</span></span><br><span class="line">readerStream.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span> (<span class="params">chunk</span>) &#123;</span><br><span class="line">  data += chunk</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">readerStream.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data) <span class="comment">// 这里就是输出了文件内容</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">readerStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">stack</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;程序执行完毕&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="写入流文件"><a href="#写入流文件" class="headerlink" title="写入流文件"></a>写入流文件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = <span class="string">&#x27;我是写入文件的内容&#x27;</span></span><br><span class="line"><span class="comment">// 创建一个可以写入的流，写入到文件 output.txt 中</span></span><br><span class="line"><span class="keyword">var</span> writerStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;output.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 utf8 编码写入数据</span></span><br><span class="line">writerStream.<span class="title function_">write</span>(data, <span class="string">&#x27;UTF8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 标记文件末尾</span></span><br><span class="line">writerStream.<span class="title function_">end</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理流事件 --&gt; finish、error</span></span><br><span class="line">writerStream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;写入完成。&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">writerStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">stack</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;程序执行完毕&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="管道流"><a href="#管道流" class="headerlink" title="管道流"></a>管道流</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个可读流</span></span><br><span class="line"><span class="keyword">var</span> readerStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可写流</span></span><br><span class="line"><span class="keyword">var</span> writerStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;output.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管道读写操作</span></span><br><span class="line"><span class="comment">// 读取 input.txt 文件内容，并将内容写入到 output.txt 文件中</span></span><br><span class="line">readerStream.<span class="title function_">pipe</span>(writerStream)</span><br></pre></td></tr></table></figure>

<h4 id="链式流-压缩-解压"><a href="#链式流-压缩-解压" class="headerlink" title="链式流(压缩+解压)"></a>链式流(压缩+解压)</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩 input.txt 文件为 input.txt.gz</span></span><br><span class="line">fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>)</span><br><span class="line">  .<span class="title function_">pipe</span>(zlib.<span class="title function_">createGzip</span>())</span><br><span class="line">  .<span class="title function_">pipe</span>(fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt.gz&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解压 input.txt.gz 文件为 input.txt</span></span><br><span class="line">fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt.gz&#x27;</span>)</span><br><span class="line">  .<span class="title function_">pipe</span>(zlib.<span class="title function_">createGunzip</span>())</span><br><span class="line">  .<span class="title function_">pipe</span>(fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt&#x27;</span>))</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/03/stream/" data-id="cles4z7sq004ursdk2lnx8koa" data-title="stream" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/" rel="tag">node</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-fs" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/03/fs/" class="article-date">
  <time class="dt-published" datetime="2023-03-03T02:35:25.000Z" itemprop="datePublished">2023-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/03/fs/">fs</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="fs-模块"><a href="#fs-模块" class="headerlink" title="fs 模块"></a>fs 模块</h3><p>nodejs 的内置模块，主要用于文件操作。下面介绍几种常见用法。</p>
<ol>
<li>权限介绍<br><img src="/2023/03/03/fs/fs-01.jpeg"></li>
</ol>
<h4 id="普通用法"><a href="#普通用法" class="headerlink" title="普通用法"></a>普通用法</h4><h5 id="引用方法"><a href="#引用方法" class="headerlink" title="引用方法"></a>引用方法</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">&#x27;node:fs&#x27;</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(filePath, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;data&#x27;</span>, data)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 同步</span></span><br><span class="line"><span class="keyword">const</span> fileResult = fs.<span class="title function_">readFileSync</span>(filePath, <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;data&#x27;</span>, fileResult)</span><br></pre></td></tr></table></figure>

<h5 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * options是可选参数, 配置项为</span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> *   encoding: &#123;String || null&#125; default = &#x27;utf8&#x27;,</span></span><br><span class="line"><span class="comment"> *   mode: &#123;Number&#125; default = 438,</span></span><br><span class="line"><span class="comment"> *   flag: &#123;String&#125; default = &#x27;w&#x27;, flag值，默认为w,会清空文件，然后再写。flag值，r代表读取文件，w代表写文件，a代表追加。</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步</span></span><br><span class="line">fs.<span class="title function_">writeFile</span>(fileName, data, [, options], callback)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步</span></span><br><span class="line">fs.<span class="title function_">writeFileSync</span>(fileName, data [, options])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="写文件-追加内容"><a href="#写文件-追加内容" class="headerlink" title="写文件(追加内容)"></a>写文件(追加内容)</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步</span></span><br><span class="line">fs.<span class="title function_">appendFile</span>(fileName, data, [, options], callback)</span><br><span class="line"><span class="comment">// 同步</span></span><br><span class="line">fs.<span class="title function_">appendFileSync</span>(fileName, data, [, options])</span><br></pre></td></tr></table></figure>

<h5 id="拷贝文件"><a href="#拷贝文件" class="headerlink" title="拷贝文件"></a>拷贝文件</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步</span></span><br><span class="line">fs.<span class="title function_">copyFile</span>(fileNameA, fileNameB, callback)</span><br><span class="line"><span class="comment">// 同步</span></span><br><span class="line">fs.<span class="title function_">copyFileSync</span>(fileNameA, fileNameB)</span><br></pre></td></tr></table></figure>

<h5 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步</span></span><br><span class="line">fs.<span class="title function_">unlink</span>(filePath, callback)</span><br><span class="line"><span class="comment">// 同步</span></span><br><span class="line">fs.<span class="title function_">unlinkSync</span>(filePath, callback)</span><br></pre></td></tr></table></figure>

<h5 id="文件打开"><a href="#文件打开" class="headerlink" title="文件打开"></a>文件打开</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 大文件操作与上面的有所不同，可以用 fs.open打开，fs.read / fs.write 读写， 最后fs.close 关闭</span></span><br><span class="line">fs.<span class="title function_">open</span>(path, flags, [,mode], callback)</span><br><span class="line">fs.<span class="title function_">close</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例用法</span></span><br><span class="line"><span class="comment">// copy 方法 一般不用这个，可以借助stream</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copy</span>(<span class="params">src, dest, size = <span class="number">16</span> * <span class="number">1024</span>, callback</span>) &#123;</span><br><span class="line">  <span class="comment">// 打开源文件</span></span><br><span class="line">  fs.<span class="title function_">open</span>(src, <span class="string">&#x27;r&#x27;</span>, <span class="function">(<span class="params">err, readFd</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 打开目标文件</span></span><br><span class="line">    fs.<span class="title function_">open</span>(dest, <span class="string">&#x27;w&#x27;</span>, <span class="function">(<span class="params">err, writeFd</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(size);</span><br><span class="line">      <span class="keyword">let</span> readed = <span class="number">0</span>; <span class="comment">// 下次读取文件的位置</span></span><br><span class="line">      <span class="keyword">let</span> writed = <span class="number">0</span>; <span class="comment">// 下次写入文件的位置</span></span><br><span class="line"></span><br><span class="line">      (<span class="keyword">function</span> <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 读取</span></span><br><span class="line">        fs.<span class="title function_">read</span>(readFd, buf, <span class="number">0</span>, size, readed, <span class="function">(<span class="params">err, bytesRead</span>) =&gt;</span> &#123;</span><br><span class="line">          readed += bytesRead;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 如果都不到内容关闭文件</span></span><br><span class="line">          <span class="keyword">if</span> (!bytesRead) fs.<span class="title function_">close</span>(readFd, <span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;关闭源文件&#x27;</span>));</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 写入</span></span><br><span class="line">          fs.<span class="title function_">write</span>(writeFd, buf, <span class="number">0</span>, bytesRead, writed, <span class="function">(<span class="params">err, bytesWritten</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 如果没有内容了同步缓存，并关闭文件后执行回调</span></span><br><span class="line">            <span class="keyword">if</span> (!bytesWritten) &#123;</span><br><span class="line">              <span class="comment">// fs.fsync 是请求将打开文件描述符的所有数据刷新到存储设备。 具体实现是操作系统和设备特定的。</span></span><br><span class="line">              fs.<span class="title function_">fsync</span>(writeFd, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                fs.<span class="title function_">close</span>(writeFd, <span class="function"><span class="params">err</span> =&gt;</span> <span class="keyword">return</span> !err &amp;&amp; <span class="title function_">callback</span>());</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            writed += bytesWritten;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 继续读取、写入</span></span><br><span class="line">            <span class="title function_">next</span>();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;)();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Promise-用法"><a href="#Promise-用法" class="headerlink" title="Promise 用法"></a>Promise 用法</h4><h5 id="引入方法"><a href="#引入方法" class="headerlink" title="引入方法"></a>引入方法</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">&#x27;node:fs/promises&#x27;</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs/promises&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="使用示例-readFile"><a href="#使用示例-readFile" class="headerlink" title="使用示例 readFile"></a>使用示例 readFile</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; readFile &#125; <span class="keyword">from</span> <span class="string">&#x27;node:fs/promises&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">readFile</span>(<span class="string">&#x27;/tmp/hello&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;data&#x27;</span>, data)</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;error&#x27;</span>, err.<span class="property">message</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所有其他语法promise语法类似……</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/03/fs/" data-id="cles4z7sc0031rsdk42d7ajpe" data-title="fs" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/" rel="tag">node</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-merge-multiple-csv-or-xlsx" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/02/27/merge-multiple-csv-or-xlsx/" class="article-date">
  <time class="dt-published" datetime="2023-02-27T07:00:31.000Z" itemprop="datePublished">2023-02-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/02/27/merge-multiple-csv-or-xlsx/">merge-multiple-csv-or-xlsx</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="合并多个列相同的文件到同一个，eg：csv，xlsx文件"><a href="#合并多个列相同的文件到同一个，eg：csv，xlsx文件" class="headerlink" title="合并多个列相同的文件到同一个，eg：csv，xlsx文件"></a>合并多个列相同的文件到同一个，eg：csv，xlsx文件</h3><p>生活中总有那么一种问题，丢你几十上百个csv，或者xlsx文件，让你筛选里面的条件达到某一个取出。今日的我就遇到了，手工达人是不可能手工达人的，我们要实现全自动化！</p>
<h4 id="合并多个csv"><a href="#合并多个csv" class="headerlink" title="合并多个csv"></a>合并多个csv</h4><p>未实际操作的方案（因为我是windows党…）， linux系统的copy csv方案。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /&#123;your all csv dir&#125;</span><br><span class="line">cat *.csv all.csv</span><br></pre></td></tr></table></figure>

<p>实操了2种方案 (本人实际操作过，都可以。速度也还能接受)</p>
<ol>
<li>windows 复制多个csv到同一个</li>
</ol>
<p>操作路径：<br>打开cmd（注意一定要是cmd，powershell是不会成功滴）<br>然后进入到你的所有csv存在的目录下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy *.csv all.csv   ----  对的，就这一行命令。搞定！无需任何安装，无需编码环境。高手中的高手~、</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>若你是开发者，还可以看看python 的pandas操作。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># set working directory</span></span><br><span class="line">os.chdir(<span class="string">&quot;csv_1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># find all csv files in the folder</span></span><br><span class="line"><span class="comment"># use glob pattern matching -&gt; extension = &#x27;csv&#x27;</span></span><br><span class="line"><span class="comment"># save result in list -&gt; all_filenames</span></span><br><span class="line">extension = <span class="string">&#x27;csv&#x27;</span></span><br><span class="line">all_filenames = [i <span class="keyword">for</span> i <span class="keyword">in</span> glob.glob(<span class="string">&#x27;*.&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(extension))]</span><br><span class="line"><span class="comment"># print(all_filenames)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># combine all files in the list, encoding need to change for yourself actual </span></span><br><span class="line">combined_csv = pd.concat([pd.read_csv(f, encoding=<span class="string">&#x27;ANSI&#x27;</span>)</span><br><span class="line">                         <span class="keyword">for</span> f <span class="keyword">in</span> all_filenames]) </span><br><span class="line"></span><br><span class="line"><span class="comment"># combine all files in the list</span></span><br><span class="line"><span class="comment"># combined_xlsx = pd.read_excel</span></span><br><span class="line"><span class="comment"># export to csv</span></span><br><span class="line">combined_csv.to_csv(<span class="string">&quot;combined_csv.csv&quot;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="合并多个xlsx"><a href="#合并多个xlsx" class="headerlink" title="合并多个xlsx"></a>合并多个xlsx</h4><p>这个就没有找到cmd的操作方案了，不过pandas依旧yyds</p>
<p>祭出代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">os.chdir(<span class="string">&quot;xlsx_1&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">extension = <span class="string">&#x27;xlsx&#x27;</span></span><br><span class="line">all_filenames = [i <span class="keyword">for</span> i <span class="keyword">in</span> glob.glob(<span class="string">&#x27;*.&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(extension))]</span><br><span class="line"></span><br><span class="line">combined_csv = pd.concat(</span><br><span class="line">    [</span><br><span class="line">        pd.read_excel(f)</span><br><span class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> all_filenames</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">combined_csv.to_excel(<span class="string">&quot;combined_result.xlsx&quot;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/02/27/merge-multiple-csv-or-xlsx/" data-id="cles4z7sl0044rsdkhh53huaj" data-title="merge-multiple-csv-or-xlsx" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/csv-xlsx/" rel="tag">csv, xlsx</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-encryption" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/02/21/encryption/" class="article-date">
  <time class="dt-published" datetime="2023-02-21T09:16:00.000Z" itemprop="datePublished">2023-02-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/02/21/encryption/">encryption</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="加密方式"><a href="#加密方式" class="headerlink" title="加密方式"></a>加密方式</h3><p>介绍加密方式。</p>
<h4 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CryptoJS</span> = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="string">&#x27;xxxxxxxxxxx&#x27;</span>) <span class="comment">//十六位十六进制数作为密钥</span></span><br><span class="line"><span class="keyword">const</span> iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="string">&#x27;xxxxxxxxxxxxx&#x27;</span>) <span class="comment">//十六位十六进制数作为密钥偏移量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Encrypt</span>(<span class="params">word</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> srcs = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(word)</span><br><span class="line">  <span class="keyword">let</span> encrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(srcs, key, &#123;</span><br><span class="line">    <span class="attr">iv</span>: iv,</span><br><span class="line">    <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">    <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> encrypted.<span class="property">ciphertext</span>.<span class="title function_">toString</span>().<span class="title function_">toUpperCase</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Decrypt</span>(<span class="params">word</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> encryptedHexStr = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Hex</span>.<span class="title function_">parse</span>(word)</span><br><span class="line">  <span class="keyword">let</span> srcs = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">stringify</span>(encryptedHexStr)</span><br><span class="line">  <span class="keyword">let</span> decrypt = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(srcs, key, &#123;</span><br><span class="line">    <span class="attr">iv</span>: iv,</span><br><span class="line">    <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">    <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">let</span> decryptedStr = decrypt.<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>)</span><br><span class="line">  <span class="keyword">return</span> decryptedStr.<span class="title function_">toString</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">NodeRSA</span> = <span class="built_in">require</span>(<span class="string">&#x27;node-rsa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> publicKey = <span class="string">&#x27;xxxxxxxxxxxxxx&#x27;</span></span><br><span class="line"><span class="keyword">const</span> privateKey = <span class="string">&#x27;xxxxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line"><span class="comment">// 加密</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encrypted</span>(<span class="params">str</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> publicKeyObj = <span class="keyword">new</span> <span class="title class_">NodeRSA</span>(publicKey)</span><br><span class="line">  publicKeyObj.<span class="title function_">setOptions</span>(&#123; <span class="attr">encryptionScheme</span>: <span class="string">&#x27;pkcs1&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> encrypted = publicKeyObj.<span class="title function_">encrypt</span>(str, <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> encrypted</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解密</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">decrypted</span>(<span class="params">str</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> privateKeyObj = <span class="keyword">new</span> <span class="title class_">NodeRSA</span>(privateKey)</span><br><span class="line">  privateKeyObj.<span class="title function_">setOptions</span>(&#123; <span class="attr">encryptionScheme</span>: <span class="string">&#x27;pkcs1&#x27;</span> &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> decrypted = privateKeyObj.<span class="title function_">decrypt</span>(str, <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(decrypted)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/02/21/encryption/" data-id="cles4z7s20026rsdkhiekhurl" data-title="encryption" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/encryption/" rel="tag">encryption</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-xlsx-create-and-download" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/02/21/xlsx-create-and-download/" class="article-date">
  <time class="dt-published" datetime="2023-02-21T08:13:44.000Z" itemprop="datePublished">2023-02-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/02/21/xlsx-create-and-download/">xlsx-create-and-download</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="xlsx-生成"><a href="#xlsx-生成" class="headerlink" title="xlsx 生成"></a>xlsx 生成</h3><h4 id="node-端根据数据库返回生成文件流"><a href="#node-端根据数据库返回生成文件流" class="headerlink" title="node 端根据数据库返回生成文件流"></a>node 端根据数据库返回生成文件流</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/test&#x27;</span>, <span class="function"><span class="params">ctx</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = [</span><br><span class="line">    [<span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;年龄&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;张三&#x27;</span>, <span class="number">20</span>],</span><br><span class="line">    [<span class="string">&#x27;李四&#x27;</span>, <span class="number">30</span>],</span><br><span class="line">  ]</span><br><span class="line">  <span class="keyword">const</span> res = xlsx.<span class="title function_">build</span>([&#123; <span class="attr">name</span>: <span class="string">&#x27;sheet1&#x27;</span>, <span class="attr">data</span>: data &#125;])</span><br><span class="line">  ctx.<span class="property">response</span>.<span class="property">body</span> = res</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="前端获取文件流并下载文件"><a href="#前端获取文件流并下载文件" class="headerlink" title="前端获取文件流并下载文件"></a>前端获取文件流并下载文件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;http://localhost:9000/test&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">blob</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> downloadURL = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(data)</span><br><span class="line">    <span class="keyword">const</span> a = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    a.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    a.<span class="property">href</span> = downloadURL</span><br><span class="line">    a.<span class="property">download</span> = <span class="string">&#x27;fileName.xlsx&#x27;</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(a)</span><br><span class="line">    a.<span class="title function_">click</span>()</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(a)</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">revokeObjectURL</span>(downloadURL)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<h4 id="node-端生成-xlsx-文件存储到文件，接口返回"><a href="#node-端生成-xlsx-文件存储到文件，接口返回" class="headerlink" title="node 端生成 xlsx 文件存储到文件，接口返回"></a>node 端生成 xlsx 文件存储到文件，接口返回</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成xlsx文件</span></span><br><span class="line"><span class="keyword">let</span> buffer = xlsx.<span class="title function_">build</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;sheet1&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: xlsxData,</span><br><span class="line">  &#125;,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入生成excel到文件夹</span></span><br><span class="line">fs.<span class="title function_">writeFileSync</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">`files/<span class="subst">$&#123;fileName&#125;</span>`</span>), buffer, &#123;</span><br><span class="line">  <span class="attr">flag</span>: <span class="string">&#x27;w&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口返回代碼，将文件夹中的xlsx文件返回</span></span><br><span class="line"><span class="keyword">const</span> filePath = path.<span class="title function_">resolve</span>(<span class="string">&#x27;/files&#x27;</span>, fileName)</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">&#x27;koa-send&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ctx.<span class="title function_">attachment</span>(filePath)</span><br><span class="line">ctx.<span class="title function_">set</span>(<span class="string">&#x27;Content-disposition&#x27;</span>, <span class="string">`attachment;filename=&quot;<span class="subst">$&#123;fileName&#125;</span>&quot;`</span>)</span><br><span class="line"><span class="keyword">await</span> <span class="title function_">send</span>(ctx, filePath)</span><br></pre></td></tr></table></figure>

<h4 id="前端直接-a-标签获取"><a href="#前端直接-a-标签获取" class="headerlink" title="前端直接 a 标签获取"></a>前端直接 a 标签获取</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;xxxxxx&quot;</span> download&gt;下载&lt;/a&gt;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/02/21/xlsx-create-and-download/" data-id="cles4z7su005irsdk6tx8axdh" data-title="xlsx-create-and-download" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xlsx/" rel="tag">xlsx</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-frp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/11/28/frp/" class="article-date">
  <time class="dt-published" datetime="2022-11-28T13:28:02.000Z" itemprop="datePublished">2022-11-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/11/28/frp/">frp</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>frp：</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a></p>
<p>服务端配置：（frps.ini)</p>
<p><img src="/2022/11/28/frp/frp-01.png"></p>
<p>用户A（客户端1）：（frpc.ini)<br><img src="/2022/11/28/frp/frp-02.png"><br>访问地址1：</p>
<p>173.xxx.xx.14:56801 就会转到你本地的 127.0.0.1:7778端口</p>
<p>用户B(客户端2)：（frpc.ini)<br><img src="/2022/11/28/frp/frp-03.png"></p>
<p>访问地址2：</p>
<p>173.xxx.xx.14:56802 就会转到你本地的 127.0.0.1:7779 端口</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/11/28/frp/" data-id="cles4z7sb002zrsdkf4i21d76" data-title="frp" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tools/" rel="tag">Tools</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-js-variable" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/04/08/js-variable/" class="article-date">
  <time class="dt-published" datetime="2022-04-08T13:38:51.000Z" itemprop="datePublished">2022-04-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/04/08/js-variable/">js-variable</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="前端变量命名的规范"><a href="#前端变量命名的规范" class="headerlink" title="前端变量命名的规范"></a>前端变量命名的规范</h3><blockquote>
<p>变量即是用来存储信息的，那么我们js的变量的命名有两个限制</p>
</blockquote>
<ol>
<li>变量名称必须仅包含字母, 数字, 符号 $ 和 _</li>
<li>首字母不能是数字 </li>
<li>非保留字<br><code>break,case,catch,class,const,continue,debugger,default,delete,do,else, export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this, throw,try,typeof,var,void,while,with,yield</code>等<br>根据以上两则限制，我们可以举出一下例子。</li>
</ol>
<p>有效的命名:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let username, UserName, USERNAME, username1, u1, _username, $username, u1$, u1_ ...... 等等</span><br></pre></td></tr></table></figure>

<p>无效的命名:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let user@, user%, 23user, 2333, !sus1等</span><br></pre></td></tr></table></figure>

<h4 id="通用规范"><a href="#通用规范" class="headerlink" title="通用规范"></a>通用规范</h4><p>js 一般采用驼峰式命名，eg: isSure, isLong, infoData 等等类似， 如果是一个单词，就直接采用小写， eg: age, sex, name</p>
<h4 id="全大写"><a href="#全大写" class="headerlink" title="全大写"></a>全大写</h4><p>但是你肯定也在js里面见到过全是大写定义的变量，比如:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">COLORRED</span> = <span class="string">&#x27;#F00&#x27;</span>,</span><br><span class="line">    <span class="variable constant_">MAXNUM</span> = <span class="number">100</span></span><br></pre></td></tr></table></figure>

<p>全大写，一般是代表这个数是一个常量，也就是说不会被改变的数字。</p>
<h4 id="开头"><a href="#开头" class="headerlink" title="_开头"></a>_开头</h4><p>变量私有但可以暴露给外部访问，则用单个下划线。<br>eg：var _status &#x3D; false</p>
<p>变量私有且只在特定范围内有效，强烈不建议直接访问，则用双下划线。<br>__selfStatus &#x3D; true</p>
<p>单下划线的私有变量，可以直接访问，但不能用于修改。<br>双下划线的变量既不能直接访问更不能直接修改。</p>
<h4 id="开头-1"><a href="#开头-1" class="headerlink" title="$开头"></a>$开头</h4><p>与关键字或保留字或内置变量同名的变量用前缀符号$表示，并且$应该在下划线后。<br>eg： $options, $class, __$dirname</p>
<h4 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h4><p>构造函数应该首字母大写<br>必填参数小驼峰，选填参数用_xX</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">eg： <span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clone</span>(<span class="params">obj, _isDeep</span>)</span><br></pre></td></tr></table></figure>

<h4 id="一般常用场景分析"><a href="#一般常用场景分析" class="headerlink" title="一般常用场景分析"></a>一般常用场景分析</h4><h5 id="表示可见性，进行中状态的推荐方式isXxx"><a href="#表示可见性，进行中状态的推荐方式isXxx" class="headerlink" title="表示可见性，进行中状态的推荐方式isXxx"></a>表示可见性，进行中状态的推荐方式isXxx</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">eg: </span><br><span class="line">isShow: 是否展示</span><br><span class="line">isVisible: 是否可见</span><br><span class="line">isRunning: 正在运行中</span><br><span class="line">isLoading: 正在加载中</span><br></pre></td></tr></table></figure>
<h5 id="配置类，选项类"><a href="#配置类，选项类" class="headerlink" title="配置类，选项类"></a>配置类，选项类</h5><p>allowXx表示功能属性，noXx, 不建议</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allowScale, noDeal</span><br></pre></td></tr></table></figure>

<h5 id="函数命名"><a href="#函数命名" class="headerlink" title="函数命名"></a>函数命名</h5><p>主动监听采用onXx, 被动处理使用handleXx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eg: onSubmit, handleStatusChange, onKeydown 等</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/04/08/js-variable/" data-id="cles4z7sk0042rsdkbvzrgvrb" data-title="js-variable" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-vue3-proxy" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/17/vue3-proxy/" class="article-date">
  <time class="dt-published" datetime="2021-09-17T07:54:03.000Z" itemprop="datePublished">2021-09-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/17/vue3-proxy/">vue3-proxy</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="VUE3-初学"><a href="#VUE3-初学" class="headerlink" title="VUE3 初学"></a>VUE3 初学</h3><blockquote>
<p>本次 vue3 学习主要针对两个点(哈哈，其实 80%内容也是来自 API)，第一个： proxy， 第二个：Composition API(函数组件)，其余 api 文档相关的就不学习太多，我觉得自己也不如 api 说得好，就好似 vue 最好的教程肯定不是去网上各种学习，而是看 api 文档，当遇到不懂的，再去搜一圈例子来理解一样。</p>
</blockquote>
<h4 id="copy-api-的-vue3-重点变化"><a href="#copy-api-的-vue3-重点变化" class="headerlink" title="copy api 的 vue3 重点变化"></a>copy api 的 vue3 重点变化</h4><h4 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h4><h5 id="了解-proxy-代理"><a href="#了解-proxy-代理" class="headerlink" title="了解 proxy 代理"></a>了解 proxy 代理</h5><blockquote>
<p>proxy 对象用于创建一个<code>对象的代理</code>，从而实现基本操作的拦截和自定义（如属性查找、赋值、枚举、函数调用等）</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// target 需要代理的目标对象, 可以是 任何类型的对象，包括原生数组，函数，甚至另一个代理</span></span><br><span class="line"><span class="comment">// handle 是以函数为属性的对象，用来定制拦截行文</span></span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handle);</span><br><span class="line"><span class="keyword">const</span> origin = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="title class_">Proxy</span>(origin, &#123;</span><br><span class="line">  <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params">target, propKey, receiver</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;10&quot;</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">obj.<span class="property">a</span>; <span class="comment">// 10</span></span><br><span class="line">obj.<span class="property">b</span>; <span class="comment">// 10</span></span><br><span class="line">origin.<span class="property">a</span>; <span class="comment">// undefined</span></span><br><span class="line">origin.<span class="property">b</span>; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<ul>
<li>handler 对象常用的方法</li>
<li>has(), in 操作符的捕捉器 eg: ‘a’ in originProxy</li>
<li>get(), 属性读取的捕捉器， eg: originProxy.a</li>
<li>set(), 属性设置操作的捕捉器，eg: originProxy.a &#x3D; ‘20’</li>
<li>deleteProperty(), delete 操作符的捕捉器，eg: delete originProxy.a</li>
<li>ownKeys(), Object.getOwnPropertyNames 和 Object.getOwnPropertySymbols 方法的捕捉器。eg:</li>
<li>apply(), 函数在调用时捕捉器, eg: sumProxy(1, 2)</li>
<li>construct(), new 操作符的捕捉器，eg: new sumProxy(1, 2)</li>
</ul>
<h5 id="了解-vue3-0-之前使用的-defineProperty"><a href="#了解-vue3-0-之前使用的-defineProperty" class="headerlink" title="了解 vue3.0 之前使用的 defineProperty"></a>了解 vue3.0 之前使用的 defineProperty</h5><blockquote>
<p>Object.defineProperty() 方法会直接在一个<code>对象上</code>定义一个<code>新属性</code>，或者修改一个对象的现有属性，并返回此对象。<br>划重点：<code>对象上，属性</code>，我们可以理解为是针对对象上的某一个属性做处理的</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> defineObj = &#123;&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(defineObj, <span class="string">&quot;a&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start set val&quot;</span>, val);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start get val&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;111&quot;</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">defineObj.<span class="property">b</span> = <span class="string">&quot;bbbb&quot;</span>; <span class="comment">// 无</span></span><br><span class="line">defineObj.<span class="property">a</span> = <span class="string">&quot;aaaaa&quot;</span>; <span class="comment">// start set val aaaaa</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(defineObj.<span class="property">a</span>); <span class="comment">// start get val \n 111</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>所以 vue 里面对象新增字段双向绑定数据不更新的原因就很好理解了，因为 defineProperty 本身针对劫持的对象的属性，而非对象本身。</p>
</blockquote>
<h4 id="Composition-API"><a href="#Composition-API" class="headerlink" title="Composition API"></a>Composition API</h4><blockquote>
<p>为何要函数组件式编程<br><img src="http://static.zeroyh.cn/aaaaa.image" alt="图"></p>
</blockquote>
<ul>
<li>更好的共享和重用代码，打包尺寸：每个函数都可作为 named ES export 被单独引入，对 tree-shaking 很友好；其次所有函数名和 setup 函数内部的变量都能被压缩，所以能有更好的压缩效率</li>
</ul>
<p>之前我们的组件大概的样子是</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// str.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; infomation &#125;&#125;<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        data () &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">infomation</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">craeted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">getInfo</span>()</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">getInfo</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">axios</span>.<span class="title function_">get</span>(<span class="variable constant_">GET_INFO</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">infomation</span> = res</span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>那么如果父级页面需要获取 infomation 或者调用子组件的 getInfo 方法的时候，常用的有</p>
<ul>
<li>父组件调用： let info &#x3D; this.$refs.str.getInfo()</li>
<li>或者子组件触发回调 this.$emit(‘info’, this.infomation)</li>
</ul>
<p>现在可以用 setup 函数后改写下当前例子</p>
<blockquote>
<p>setup 函数在组件创建之前就会触发，</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// str.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; infomation &#125;&#125;<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; ref, onCreated &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> infomation = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> <span class="title function_">getInfo</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">                infomation = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">axios</span>.<span class="title function_">get</span>(<span class="variable constant_">GET_INFO</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">onCreated</span>(getInfo)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                infomation,</span></span><br><span class="line"><span class="language-javascript">                getInfo</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面这个例子不能体现出 vue3 composition 的优势，但是能把一块逻辑统一到一块。这是个热身。</p>
<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;高能预警了哈！&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<p>列表分页查询方案<br>1）变量存储 (重复操作过多） 2) mixins (重复空间减少，命名空间冲突，特别是一个页面涉及 2 个的时候）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Page</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:total</span>=<span class="string">&quot;pageData.total&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:current</span>=<span class="string">&quot;pageData.current&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:pageSize</span>=<span class="string">&quot;pageData.pageSize&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:pageSizeOpts</span>=<span class="string">&quot;pageData.pageSizeOpts&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">transfer</span></span></span><br><span class="line"><span class="tag">  <span class="attr">show-elevator</span></span></span><br><span class="line"><span class="tag">  <span class="attr">show-sizer</span></span></span><br><span class="line"><span class="tag">  <span class="attr">show-total</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">on-change</span>=<span class="string">&quot;pageChange&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">on-page-size-change</span>=<span class="string">&quot;pageSizeChange&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">pageData</span>: &#123;</span><br><span class="line">        <span class="attr">total</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">current</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pageSize</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">pageSizeOpts</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">pageChange</span>(<span class="params">num</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">pageData</span>.<span class="property">current</span> = num;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">pageSizeChange</span>(<span class="params">size</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">pageData</span>.<span class="property">pagesize</span> = size;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>上面代码里面的 pageData 和 methods 的方法，几乎是所有 page 引用都需要 CV 的代码</p>
<p>VUE3 下面就可以提取这块逻辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hooks/page.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">usePaging</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> conditions = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">total</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">current</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">pageSize</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">pageSizeOpts</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>],</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">pageChange</span> = (<span class="params">num</span>) =&gt; &#123;</span><br><span class="line">    conditions.<span class="property">current</span> = num;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">pageSizeChange</span> = (<span class="params">size</span>) =&gt; &#123;</span><br><span class="line">    conditions.<span class="property">pageSize</span> = size;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    conditions,</span><br><span class="line">    pageChange,</span><br><span class="line">    pageSizeChange,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x2F;&#x2F; 组件里面应用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Page</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:total</span>=<span class="string">&quot;pageData.total&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:current</span>=<span class="string">&quot;pageData.current&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:pageSize</span>=<span class="string">&quot;pageData.pageSize&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:pageSizeOpts</span>=<span class="string">&quot;pageData.pageSizeOpts&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">transfer</span></span></span><br><span class="line"><span class="tag">  <span class="attr">show-elevator</span></span></span><br><span class="line"><span class="tag">  <span class="attr">show-sizer</span></span></span><br><span class="line"><span class="tag">  <span class="attr">show-total</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">on-change</span>=<span class="string">&quot;pageChange&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">on-page-size-change</span>=<span class="string">&quot;pageSizeChange&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; usePage &#125; <span class="keyword">from</span> <span class="string">&quot;hooks/page&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">conditions</span>: pageData, pageChange, pageSizeChange &#125; = <span class="title function_">usePage</span>(); <span class="comment">// 可监听变化</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">watch</span>([<span class="function">() =&gt;</span> pageData.<span class="property">page</span>, <span class="function">() =&gt;</span> pageData.<span class="property">pageSize</span>], <span class="function">(<span class="params">[val1, val2]</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;conditions changed，do search&quot;</span>, val1, val2);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123; pageData, pageChange, pageSizeChange &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/09/17/vue3-proxy/" data-id="cles4z7ss0058rsdkbxpqfcem" data-title="vue3-proxy" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-js-design-mode" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/06/js-design-mode/" class="article-date">
  <time class="dt-published" datetime="2021-07-06T07:26:55.000Z" itemprop="datePublished">2021-07-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/06/js-design-mode/">js-design-mode</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代理模式</span></span><br><span class="line"><span class="keyword">var</span> myImage = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> imgNode = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(imgNode)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">setSrc</span>(<span class="params">src</span>) &#123;</span><br><span class="line">            imgNode.<span class="property">src</span>=src</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> proxyImage = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>;</span><br><span class="line">    img.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        myImage.<span class="title function_">setSrc</span>(<span class="variable language_">this</span>.<span class="property">src</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">setSrc</span>(<span class="params">src</span>) &#123;</span><br><span class="line">            myImage.<span class="title function_">setSrc</span>(<span class="string">&#x27;https://img-blog.csdnimg.cn/20200330145320871.png&#x27;</span>)</span><br><span class="line">            img.<span class="property">src</span> = src</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">proxyImage.<span class="title function_">setSrc</span>(<span class="string">&#x27;https://img-blog.csdnimg.cn/2020033014534669.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjIwNzM1Mw==,size_16,color_FFFFFF,t_70&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 迭代器模式</span></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">var</span> appendDiv = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;data.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">        div.<span class="property">innerHTML</span> = data[i]</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">appendDiv</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">var</span> each = <span class="keyword">function</span>(<span class="params">target, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> value,</span><br><span class="line">        i=<span class="number">0</span>,</span><br><span class="line">        length = target.<span class="property">length</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(target)) &#123;</span><br><span class="line">        <span class="keyword">for</span> (; i&lt;length; i++) &#123;</span><br><span class="line">            callback.<span class="title function_">call</span>(target[i], i, target[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> target) &#123;</span><br><span class="line">            callback.<span class="title function_">call</span>(target[i], i, target[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> aD = <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="title function_">each</span>(data, <span class="keyword">function</span>(<span class="params">i, v</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">        div.<span class="property">innerHTML</span> = <span class="string">`<span class="subst">$&#123;i&#125;</span>: <span class="subst">$&#123;v&#125;</span>`</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">aD</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="title function_">aD</span>(&#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 单例模式</span></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">var</span> createModal = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> modal</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!modal) &#123;</span><br><span class="line">            modal = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">            modal.<span class="property">innerHTML</span> = <span class="string">&#x27;i am a modal 1&#x27;</span></span><br><span class="line">            modal.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(modal)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> modal</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="title function_">createModal</span>()</span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">var</span> getSingle = <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> result</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result || (result = fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> onlyCreate = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> modal = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    modal.<span class="property">innerHTML</span> = <span class="string">&#x27;i am a modal 2&#x27;</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(modal)</span><br><span class="line">    <span class="keyword">return</span> modal</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> createS = <span class="title function_">getSingle</span>(onlyCreate)</span><br><span class="line"><span class="keyword">var</span> singleModal1 = <span class="title function_">createS</span>()</span><br><span class="line"><span class="keyword">var</span> singleModal2 = <span class="title function_">createS</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(singleModal1 === singleModal2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 策略</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">var</span> calculateBonus = <span class="keyword">function</span>(<span class="params">level, salary</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (level === <span class="string">&#x27;S&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> salary * <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (level === <span class="string">&#x27;A&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> salary * <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (level === <span class="string">&#x27;B&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> salary * <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">calculateBonus</span>(<span class="string">&#x27;S&#x27;</span>, <span class="number">10000</span>)</span><br><span class="line"><span class="title function_">calculateBonus</span>(<span class="string">&#x27;A&#x27;</span>, <span class="number">12000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">var</span> performanceS = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">performanceS.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">calculate</span> = <span class="keyword">function</span>(<span class="params">salary</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> salary * <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> performanceA = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">performanceA.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">calculate</span> = <span class="keyword">function</span>(<span class="params">salary</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> salary * <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> performanceB = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">performanceB.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">calculate</span> = <span class="keyword">function</span>(<span class="params">salary</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> salary * <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Bonus</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">salary</span> = <span class="literal">null</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">strategy</span> = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Bonus</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setSalary</span> = <span class="keyword">function</span>(<span class="params">salary</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">salary</span> = salary</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Bonus</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setStrategy</span> = <span class="keyword">function</span>(<span class="params">strategy</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">strategy</span> = strategy</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Bonus</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getBonus</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="comment">// 取得奖金数额</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">strategy</span>.<span class="title function_">calculate</span>( <span class="variable language_">this</span>.<span class="property">salary</span> ) <span class="comment">// 把计算奖金的操作委托给对应的策略对象</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bonus = <span class="keyword">new</span> <span class="title class_">Bonus</span>(); <span class="comment">// 2</span></span><br><span class="line">bonus.<span class="title function_">setSalary</span>( <span class="number">10000</span> );</span><br><span class="line">bonus.<span class="title function_">setStrategy</span>( <span class="keyword">new</span> <span class="title function_">performanceS</span>() ); <span class="comment">// 设置策略对象</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( bonus.<span class="title function_">getBonus</span>() );</span><br><span class="line"></span><br><span class="line">bonus.<span class="title function_">setStrategy</span>( <span class="keyword">new</span> <span class="title function_">performanceA</span>() ); <span class="comment">// 设置策略对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( bonus.<span class="title function_">getBonus</span>() );</span><br><span class="line"></span><br><span class="line"><span class="comment">// better</span></span><br><span class="line"><span class="keyword">var</span> bonusMap = <span class="keyword">new</span> <span class="title class_">Map</span>[[</span><br><span class="line">    <span class="string">&#x27;S&#x27;</span>, <span class="function">(<span class="params">salary</span>) =&gt;</span>  salary * <span class="number">4</span></span><br><span class="line">], [</span><br><span class="line">    <span class="string">&#x27;A&#x27;</span>, <span class="function">(<span class="params">salary</span>) =&gt;</span>  salary * <span class="number">3</span></span><br><span class="line">], [</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span>, <span class="function">(<span class="params">salary</span>) =&gt;</span>  salary * <span class="number">2</span></span><br><span class="line">]]</span><br><span class="line">bonusMap[<span class="string">&#x27;S&#x27;</span>](<span class="number">10000</span>)</span><br><span class="line">bonusMap[<span class="string">&#x27;A&#x27;</span>](<span class="number">12000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布-订阅模式</span></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line">login.<span class="title function_">succ</span>(<span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    header.<span class="title function_">setAvatar</span>(data)</span><br><span class="line">    nav.<span class="title function_">refresh</span>(data)</span><br><span class="line">    message.<span class="title function_">refresh</span>(data)</span><br><span class="line">    cart.<span class="title function_">refresh</span>(<span class="title class_">Data</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(<span class="string">&#x27;http://login/api&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        login.<span class="title function_">trigger</span>(<span class="string">&#x27;success&#x27;</span>,data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> header = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    login.<span class="title function_">listen</span>(<span class="string">&#x27;success&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">        header.<span class="title function_">setAvatar</span>(data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/06/js-design-mode/" data-id="cles4z7sg003irsdk81bedh2v" data-title="js-design-mode" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-js-debounce-throttle" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/13/js-debounce-throttle/" class="article-date">
  <time class="dt-published" datetime="2020-05-13T09:47:28.000Z" itemprop="datePublished">2020-05-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/13/js-debounce-throttle/">js-debounce-throttle</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="js-节流-throttle-与防抖（debounce"><a href="#js-节流-throttle-与防抖（debounce" class="headerlink" title="js 节流(throttle)与防抖（debounce)"></a>js 节流(throttle)与防抖（debounce)</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><ul>
<li>防抖（debounce）: 一个事件不停的触发，防抖会再指定时间内没有再次触发后才执行一次。（应用场景：input 框联想：可以在用户停止输入 300ms 后再执行联想搜索）</li>
<li>节流（throttle）: 一个事件不停的触发，节流会每指定时间执行一次。（应用场景：图片懒加载：鼠标下滑，可以执行 300ms 执行一次，不用不停的执行。 拖拽窗口：拖动过程中没个 30ms 移动一次）</li>
</ul>
<h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><ul>
<li>当事件持续被触发，如果触发时间间隔短于规定的等待时间（n 秒），那么函数防抖的情况下，函数将一直推迟执行，造成不会被执行的效果；函数节流的情况下，函数将每个 n 秒执行一次</li>
</ul>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><blockquote>
<p>防抖（debounce）</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 常用版</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; func, 回调函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; wait, 防抖时间</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timer</span><br><span class="line">    <span class="keyword">return</span> functin () &#123;</span><br><span class="line">        <span class="keyword">const</span> context = <span class="variable language_">this</span></span><br><span class="line">        <span class="keyword">const</span> args = <span class="variable language_">arguments</span></span><br><span class="line">        <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> func.<span class="title function_">apply</span>(context, args), wait)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 复杂版 有立即执行的函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; func, 回调函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; wait, 防抖时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; immediate, 是否立即执行一次</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait, immediate</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> timeout;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">executedFunction</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> context = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">var</span> args = <span class="variable language_">arguments</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> later = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            timeout = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (!immediate) func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> callNow = immediate &amp;&amp; !timeout;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">        timeout = <span class="built_in">setTimeout</span>(later, wait);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (callNow) func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>节流（throttle)</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; func 回调函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; limit 每limit时间内只执行一次</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, limit</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> inThrottle;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> context = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">const</span> args = <span class="variable language_">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span> (!inThrottle) &#123;</span><br><span class="line">            func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">            inThrottle = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> (inThrottle = <span class="literal">false</span>), limit);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="lodash-源码"><a href="#lodash-源码" class="headerlink" title="lodash 源码"></a>lodash 源码</h4><blockquote>
<p>防抖(debounce)</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isObject</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> type = <span class="keyword">typeof</span> value;</span><br><span class="line">    <span class="keyword">return</span> value != <span class="literal">null</span> &amp;&amp; (type === <span class="string">&quot;object&quot;</span> || type === <span class="string">&quot;function&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait, options</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> lastArgs, lastThis, maxWait, result, timerId, lastCallTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> lastInvokeTime = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> leading = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> maxing = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> trailing = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  Bypass `requestAnimationFrame` by explicitly setting `wait=0`.</span></span><br><span class="line">    <span class="comment">//  root 参考https://github.com/lodash/lodash/blob/master/.internal/root.js</span></span><br><span class="line">    <span class="keyword">const</span> useRAF =</span><br><span class="line">        !wait &amp;&amp; wait !== <span class="number">0</span> &amp;&amp; <span class="keyword">typeof</span> root.<span class="property">requestAnimationFrame</span> === <span class="string">&quot;function&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> func !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Expected a function&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    wait = +wait || <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isObject</span>(options)) &#123;</span><br><span class="line">        leading = !!options.<span class="property">leading</span>;</span><br><span class="line">        maxing = <span class="string">&quot;maxWait&quot;</span> <span class="keyword">in</span> options;</span><br><span class="line">        maxWait = maxing ? <span class="title class_">Math</span>.<span class="title function_">max</span>(+options.<span class="property">maxWait</span> || <span class="number">0</span>, wait) : maxWait;</span><br><span class="line">        trailing = <span class="string">&quot;trailing&quot;</span> <span class="keyword">in</span> options ? !!options.<span class="property">trailing</span> : trailing;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">invokeFunc</span>(<span class="params">time</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> args = lastArgs;</span><br><span class="line">        <span class="keyword">const</span> thisArg = lastThis;</span><br><span class="line"></span><br><span class="line">        lastArgs = lastThis = <span class="literal">undefined</span>;</span><br><span class="line">        lastInvokeTime = time;</span><br><span class="line">        result = func.<span class="title function_">apply</span>(thisArg, args);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">startTimer</span>(<span class="params">pendingFunc, wait</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (useRAF) &#123;</span><br><span class="line">            root.<span class="title function_">cancelAnimationFrame</span>(timerId);</span><br><span class="line">            <span class="keyword">return</span> root.<span class="title function_">requestAnimationFrame</span>(pendingFunc);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">setTimeout</span>(pendingFunc, wait);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">cancelTimer</span>(<span class="params">id</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (useRAF) &#123;</span><br><span class="line">            <span class="keyword">return</span> root.<span class="title function_">cancelAnimationFrame</span>(id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">leadingEdge</span>(<span class="params">time</span>) &#123;</span><br><span class="line">        <span class="comment">// Reset any `maxWait` timer.</span></span><br><span class="line">        lastInvokeTime = time;</span><br><span class="line">        <span class="comment">// Start the timer for the trailing edge.</span></span><br><span class="line">        timerId = <span class="title function_">startTimer</span>(timerExpired, wait);</span><br><span class="line">        <span class="comment">// Invoke the leading edge.</span></span><br><span class="line">        <span class="keyword">return</span> leading ? <span class="title function_">invokeFunc</span>(time) : result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">remainingWait</span>(<span class="params">time</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> timeSinceLastCall = time - lastCallTime;</span><br><span class="line">        <span class="keyword">const</span> timeSinceLastInvoke = time - lastInvokeTime;</span><br><span class="line">        <span class="keyword">const</span> timeWaiting = wait - timeSinceLastCall;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> maxing</span><br><span class="line">            ? <span class="title class_">Math</span>.<span class="title function_">min</span>(timeWaiting, maxWait - timeSinceLastInvoke)</span><br><span class="line">            : timeWaiting;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">shouldInvoke</span>(<span class="params">time</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> timeSinceLastCall = time - lastCallTime;</span><br><span class="line">        <span class="keyword">const</span> timeSinceLastInvoke = time - lastInvokeTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Either this is the first call, activity has stopped and we&#x27;re at the</span></span><br><span class="line">        <span class="comment">// trailing edge, the system time has gone backwards and we&#x27;re treating</span></span><br><span class="line">        <span class="comment">// it as the trailing edge, or we&#x27;ve hit the `maxWait` limit.</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            lastCallTime === <span class="literal">undefined</span> ||</span><br><span class="line">            timeSinceLastCall &gt;= wait ||</span><br><span class="line">            timeSinceLastCall &lt; <span class="number">0</span> ||</span><br><span class="line">            (maxing &amp;&amp; timeSinceLastInvoke &gt;= maxWait)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">timerExpired</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> time = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">shouldInvoke</span>(time)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">trailingEdge</span>(time);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Restart the timer.</span></span><br><span class="line">        timerId = <span class="title function_">startTimer</span>(timerExpired, <span class="title function_">remainingWait</span>(time));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">trailingEdge</span>(<span class="params">time</span>) &#123;</span><br><span class="line">        timerId = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Only invoke if we have `lastArgs` which means `func` has been</span></span><br><span class="line">        <span class="comment">// debounced at least once.</span></span><br><span class="line">        <span class="keyword">if</span> (trailing &amp;&amp; lastArgs) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">invokeFunc</span>(time);</span><br><span class="line">        &#125;</span><br><span class="line">        lastArgs = lastThis = <span class="literal">undefined</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">cancel</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (timerId !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="title function_">cancelTimer</span>(timerId);</span><br><span class="line">        &#125;</span><br><span class="line">        lastInvokeTime = <span class="number">0</span>;</span><br><span class="line">        lastArgs = lastCallTime = lastThis = timerId = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">flush</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> timerId === <span class="literal">undefined</span> ? result : <span class="title function_">trailingEdge</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">pending</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> timerId !== <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">debounced</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> time = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">        <span class="keyword">const</span> isInvoking = <span class="title function_">shouldInvoke</span>(time);</span><br><span class="line"></span><br><span class="line">        lastArgs = args;</span><br><span class="line">        lastThis = <span class="variable language_">this</span>;</span><br><span class="line">        lastCallTime = time;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isInvoking) &#123;</span><br><span class="line">            <span class="keyword">if</span> (timerId === <span class="literal">undefined</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">leadingEdge</span>(lastCallTime);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (maxing) &#123;</span><br><span class="line">                <span class="comment">// Handle invocations in a tight loop.</span></span><br><span class="line">                timerId = <span class="title function_">startTimer</span>(timerExpired, wait);</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">invokeFunc</span>(lastCallTime);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (timerId === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            timerId = <span class="title function_">startTimer</span>(timerExpired, wait);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    debounced.<span class="property">cancel</span> = cancel;</span><br><span class="line">    debounced.<span class="property">flush</span> = flush;</span><br><span class="line">    debounced.<span class="property">pending</span> = pending;</span><br><span class="line">    <span class="keyword">return</span> debounced;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>节流(throttle)</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, wait, options</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> leading = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">let</span> trailing = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> func !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Expected a function&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isObject</span>(options)) &#123;</span><br><span class="line">        leading = <span class="string">&quot;leading&quot;</span> <span class="keyword">in</span> options ? !!options.<span class="property">leading</span> : leading;</span><br><span class="line">        trailing = <span class="string">&quot;trailing&quot;</span> <span class="keyword">in</span> options ? !!options.<span class="property">trailing</span> : trailing;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 上方的debounce函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">debounce</span>(func, wait, &#123;</span><br><span class="line">        leading,</span><br><span class="line">        trailing,</span><br><span class="line">        <span class="attr">maxWait</span>: wait,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> throttle;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/05/13/js-debounce-throttle/" data-id="cles4z7sf003grsdk1pms26yl" data-title="js-debounce-throttle" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/33-js-concepts/" rel="tag">33-js-concepts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Css/" rel="tag">Css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/" rel="tag">ES6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Html/" rel="tag">Html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PackingTools/" rel="tag">PackingTools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Product/" rel="tag">Product</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thoughts/" rel="tag">Thoughts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools/" rel="tag">Tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XMLHttpRequest/" rel="tag">XMLHttpRequest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/" rel="tag">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/components/" rel="tag">components</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csv-xlsx/" rel="tag">csv, xlsx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/encryption/" rel="tag">encryption</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitTools/" rel="tag">gitTools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/introduce/" rel="tag">introduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/other/" rel="tag">other</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/regexp/" rel="tag">regexp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wechat/" rel="tag">wechat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xlsx/" rel="tag">xlsx</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/33-js-concepts/" style="font-size: 20px;">33-js-concepts</a> <a href="/tags/Css/" style="font-size: 17.14px;">Css</a> <a href="/tags/ES6/" style="font-size: 15.71px;">ES6</a> <a href="/tags/Html/" style="font-size: 10px;">Html</a> <a href="/tags/PackingTools/" style="font-size: 11.43px;">PackingTools</a> <a href="/tags/Product/" style="font-size: 11.43px;">Product</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/Thoughts/" style="font-size: 14.29px;">Thoughts</a> <a href="/tags/Tools/" style="font-size: 12.86px;">Tools</a> <a href="/tags/XMLHttpRequest/" style="font-size: 14.29px;">XMLHttpRequest</a> <a href="/tags/canvas/" style="font-size: 11.43px;">canvas</a> <a href="/tags/components/" style="font-size: 10px;">components</a> <a href="/tags/csv-xlsx/" style="font-size: 10px;">csv, xlsx</a> <a href="/tags/encryption/" style="font-size: 10px;">encryption</a> <a href="/tags/gitTools/" style="font-size: 10px;">gitTools</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/introduce/" style="font-size: 10px;">introduce</a> <a href="/tags/javascript/" style="font-size: 18.57px;">javascript</a> <a href="/tags/nginx/" style="font-size: 12.86px;">nginx</a> <a href="/tags/node/" style="font-size: 12.86px;">node</a> <a href="/tags/other/" style="font-size: 10px;">other</a> <a href="/tags/regexp/" style="font-size: 10px;">regexp</a> <a href="/tags/wechat/" style="font-size: 11.43px;">wechat</a> <a href="/tags/xlsx/" style="font-size: 10px;">xlsx</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/03/03/stream/">stream</a>
          </li>
        
          <li>
            <a href="/2023/03/03/fs/">fs</a>
          </li>
        
          <li>
            <a href="/2023/02/27/merge-multiple-csv-or-xlsx/">merge-multiple-csv-or-xlsx</a>
          </li>
        
          <li>
            <a href="/2023/02/21/encryption/">encryption</a>
          </li>
        
          <li>
            <a href="/2023/02/21/xlsx-create-and-download/">xlsx-create-and-download</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 zero<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>